[
    {
        "idViagem":"${exchange.properties.originalPayload.idViagem}",
        "idServico":"${exchange.properties.originalPayload.idServico}"
    },
    {
        $max:{
            "velocidadeMaxima":${exchange.properties.originalPayload.velocidadeAtual}
            #if ($exchange.properties.distanciaPercorrida)
                ,"totalKm":${exchange.properties.distanciaPercorrida}
            #end
        },
        $min:{"velocidadeMinima":${exchange.properties.originalPayload.velocidadeAtual}},
        $push:{
            "localizacoes":{
                "dataHoraLocalizacao":"${exchange.properties.originalPayload.dataHoraEvento}",
                "velocidade":${exchange.properties.originalPayload.velocidadeAtual},
                #if ($exchange.properties.distanciaPercorrida)
                    "distanciaPercorrida":${exchange.properties.distanciaPercorrida},
                #end
                "situacaoIgnicaoMotor":"${exchange.properties.situacaoIgnicaoMotor}",
                "situacaoPortaVeiculo":"${exchange.properties.situacaoPortaVeiculo}",
                #if ($exchange.properties.originalPayload.latitude and $exchange.properties.originalPayload.longitude)
                    "localizacao":{
                        "type":"POINT",
                        "coordinates":[
                            ${exchange.properties.originalPayload.latitude},
                            ${exchange.properties.originalPayload.longitude}
                        ]
                    }
                #end
            }
        }
    }
]